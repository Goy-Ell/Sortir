{% extends 'base.html.twig' %}

{% block title %}Créer une sortie{% endblock %}

{# //la vie est belle #}
{% block body %}

<!-- AXIOS en ligne -->


    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-12 col-sm-10 col-md-8 col-lg-4">
                <h1 class="text-center">Créer une sortie</h1>
            </div>
        </div>
    </div>


    {# Affichage form create sortie détaillé #}
    </div>
    <div class="row justify-content-center mt-5">
        <!-- 1ere colonne -->
        <div class="col-12 col-sm-10 col-md-8 col-lg-4">
            <div class="row justify-content-center mt-5">
                {{ form_start(sortieForm) }}
                <ul class="list-group">
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.nom) }}
                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget (sortieForm.nom) }}
                                    {{ form_errors (sortieForm.nom) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    <div class="form-label">{{ form_label(sortieForm.photoSortie, 'Photo de sortie') }}</div>

                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget(sortieForm.photoSortie, {'attr' : {'class': 'form-control'}}) }}
                                    {{ form_errors (sortieForm.photoSortie) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.dateHeureDebut) }}
                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget (sortieForm.dateHeureDebut) }}
                                    {{ form_errors (sortieForm.dateHeureDebut) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.dateLimiteInscription) }}
                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget (sortieForm.dateLimiteInscription) }}
                                    {{ form_errors (sortieForm.dateLimiteInscription) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.nbInscriptionMax) }}
                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget (sortieForm.nbInscriptionMax) }}
                                    {{ form_errors (sortieForm.nbInscriptionMax) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.duree) }}
                                </div>
                                <div class="col-lg-8">
                                    {{ form_widget (sortieForm.duree) }} minutes
                                    {{ form_errors (sortieForm.duree) }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-center mt-5">
                                <div class="col-lg-4">
                                    {{ form_label(sortieForm.infosSortie) }}
                                </div>
                                <div class="col-8">
                                    {{ form_widget (sortieForm.infosSortie) }}
                                    {{ form_errors (sortieForm.infosSortie) }}
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 2eme colonne -->
        <div class="col-12 col-sm-10 col-md-8 col-lg-4">
            <div class="row justify-content-center mt-5">
                <ul class="list-group">
                    <li class="list-group-item">
                        <div class="mb-4">
                            <div class="row justify-content-start mt-4">
                                <div class="col">
                                    Site école : {{ app.user.site.nom }}
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mt-3 mb-4">
                            <div class="row col-8 ms-1">
                                <label for="rechercheVille">Recherche ville :</label>
                                <input type="text" id="rechercheVille">
                            </div>
                            <div class="row col-8 ms-1 mt-1">
                                <label for="villeSelect">Choisir la ville :</label>
                                <select name="villeSelect" id="villeSelect">
                                    <!-- zone affichage resultats requete AJAX -->
                                </select>
                            </div>
                            <!-- AJAX pour la recherche de ville -->
                            <script> const rechercheVilleUrl = "{{ path('lieu_rechercheVille') }}" </script>
                            <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
                            <script>
                                let rechercheSaisi = document.getElementById("rechercheVille");
                                rechercheSaisi.addEventListener("keyup", envoyerAjaxRequest);

                                function envoyerAjaxRequest(){
                                    let saisi = rechercheSaisi.value;
                                    axios.get(rechercheVilleUrl, {
                                        params: { "saisi": saisi }
                                    })
                                        .then(function (response){
                                            console.log(response.data);
                                            let selectResultats = document.getElementById("villeSelect");
                                            selectResultats.innerHTML = response.data;
                                        });
                                }


                            </script>
                            <!-- fin: AJAX pour la recherche de ville -->
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="mt-3 mb-4">
                            <div class="row justify-content-between ms-1">
                                <div class="row col-8">
                                    <label for="lieuxSelect">Choisir le lieu :</label>
                                    <select name="lieuxSelect" id="lieuxSelect">
                                        <!-- zone affichage resultats requete AJAX -->
                                    </select>
                                    <!-- AJAX pour la recherche de lieu -->
                                    <script> const rechercheLieuSelonVilleURL = "{{ path('lieu_recherche') }}"</script>
                                    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
                                    <script>
                                        let rechercheLieu = document.getElementById("villeSelect");
                                        rechercheLieu.addEventListener('change', envoyerAjaxRequest);

                                        function envoyerAjaxRequest(){
                                            let ville = rechercheLieu.value;
                                            console.log(ville);
                                            axios.get(rechercheLieuSelonVilleURL, {
                                                params: { "ville": ville }
                                            })
                                                .then(function (response){
                                                    console.log(response.data);
                                                    let resultatsLieux = document.getElementById("lieuxSelect");
                                                    resultatsLieux.innerHTML = response.data;
                                                });
                                        }
                                    </script>
                                    <!-- fin: AJAX pour la recherche de lieu -->
                                </div>
                                <div class="col-2 me-4">
                                    <button type="button" class="btn btn-outline-light"><a href="{{ path('lieu_create') }}"><img src="{{ asset('img/icon/ajouter_lieu.png') }}" alt="bouton ajout lieu" height="50px" width="50px"></a></button>
                                </div>

                            </div>
                        </div>
                    </li>
                    <div id="coordonneesLieu">
                        <!-- div id="coordonneesLieu" sera remplacé par ajax_detailsLieu.html.twig -->
                        <li class="list-group-item">
                            <div class="mb-4 mt-4">
                                <div class="">
                                    Rue :<br>
                                    Ville :<br>
                                    Code Postal :<br>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <div class="mb-4">
                                <div class="mt-4">
                                    <div class="col-lg-2">
                                        latitude :<br>
                                        longitude :<br>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </div>
                    <!-- AJAX pour le detail du lieu -->
                    <script> const detailsLieuURL = "{{ path('lieu_detailsLieu') }}"</script>
                    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
                    <script>
                        let selectLieu = document.getElementById("lieuxSelect");
                        selectLieu.addEventListener('change', envoyerAjaxRequest);

                        function envoyerAjaxRequest(){
                            let lieu = selectLieu.value;
                            console.log(lieu);
                            axios.get(detailsLieuURL, {
                                params: { "lieu": lieu }
                            })
                                .then(function (response){
                                    console.log(response.data);
                                    let divCoordonneesLieu = document.getElementById("coordonneesLieu");
                                    divCoordonneesLieu.innerHTML = response.data;
                                });
                        }
                    </script>
                    <!-- fin: AJAX pour le detail du lieu -->
                </ul>
            </div>
        </div>
    </div>

    <div class="row justify-content-center mt-4 pb-5">
        <div class="col-12 col-sm-10 col-md-8 col-lg-4">
            <div class="row justify-content-center">
                <div class="btn-group" role="group" aria-label="Basic outlined example">
                    <button type="submit" class="btn btn-outline-primary">Enregistrer</button>

                    <a href="{{ path ('sortie_recherche') }}" class="btn btn-outline-primary">Annuler</a>
                </div>
            </div>
        </div>
    </div>

    {{ form_end(sortieForm) }}
{% endblock %}
